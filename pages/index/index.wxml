<!-- pages/index/index.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨é—®å€™ -->
  <view class="greeting-section">
    <view class="greeting-text">{{greetingText}}</view>
    <view class="date-info">{{currentDate}}</view>
    <view class="privacy-indicator">
      <image class="privacy-icon" src="../../assets/icons/shield.png" />
      <text>æ•°æ®å®‰å…¨å­˜å‚¨åœ¨æ‚¨çš„è®¾å¤‡ä¸Š</text>
    </view>
  </view>

  <!-- å¿«é€Ÿæƒ…ç»ªè®°å½• -->
  <view class="quick-record-section card">
    <view class="card-title">ä»Šå¤©çš„å¿ƒæƒ…å¦‚ä½•ï¼Ÿ</view>
    
    <!-- æƒ…ç»ªé€‰æ‹©æ–¹å¼åˆ‡æ¢ -->
    <view class="emotion-mode-tabs">
      <view 
        class="tab-item {{currentMode === 'emoji' ? 'active' : ''}}"
        bindtap="switchMode"
        data-mode="emoji"
      >
        è¡¨æƒ…
      </view>
      <view 
        class="tab-item {{currentMode === 'color' ? 'active' : ''}}"
        bindtap="switchMode"
        data-mode="color"
      >
        è‰²å½©
      </view>
      <view 
        class="tab-item {{currentMode === 'weather' ? 'active' : ''}}"
        bindtap="switchMode"
        data-mode="weather"
      >
        å¤©æ°”
      </view>
    </view>

    <!-- è¡¨æƒ…ç¬¦å·æ¨¡å¼ -->
    <view class="emoji-picker" wx:if="{{currentMode === 'emoji'}}">
      <view class="emoji-grid">
        <view 
          wx:for="{{emojiList}}" 
          wx:key="id"
          class="emoji-item {{selectedEmotion.id === item.id ? 'selected' : ''}}"
          bindtap="selectEmotion"
          data-emotion="{{item}}"
        >
          <text class="emoji">{{item.emoji}}</text>
          <text class="emotion-name">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- è‰²å½©é€‰æ‹©æ¨¡å¼ -->
    <view class="color-picker" wx:if="{{currentMode === 'color'}}">
      <view class="color-palette">
        <view 
          wx:for="{{colorList}}" 
          wx:key="id"
          class="color-item {{selectedEmotion.id === item.id ? 'selected' : ''}}"
          style="background-color: {{item.color}}"
          bindtap="selectEmotion"
          data-emotion="{{item}}"
        >
          <view class="color-overlay">
            <text class="color-name">{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å¤©æ°”æ¨¡å¼ -->
    <view class="weather-picker" wx:if="{{currentMode === 'weather'}}">
      <view class="weather-grid">
        <view 
          wx:for="{{weatherList}}" 
          wx:key="id"
          class="weather-item {{selectedEmotion.id === item.id ? 'selected' : ''}}"
          bindtap="selectEmotion"
          data-emotion="{{item}}"
        >
          <text class="weather-icon">{{item.icon}}</text>
          <text class="weather-name">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- å¼ºåº¦æ»‘å— -->
    <view class="intensity-section" wx:if="{{selectedEmotion}}">
      <view class="intensity-label">æƒ…ç»ªå¼ºåº¦: {{intensity}}/10</view>
      <slider 
        class="intensity-slider"
        min="1" 
        max="10" 
        value="{{intensity}}"
        activeColor="#4CAF50"
        backgroundColor="#e0e0e0"
        bindchange="onIntensityChange"
        show-value="{{false}}"
      />
    </view>

    <!-- å¿«é€Ÿæ ‡ç­¾ -->
    <view class="quick-tags" wx:if="{{selectedEmotion}}">
      <view class="tags-label">å¯èƒ½çš„åŸå› </view>
      <view class="tags-list">
        <view 
          wx:for="{{quickTags}}" 
          wx:key="*this"
          class="tag-item {{selectedTags.includes(item) ? 'selected' : ''}}"
          bindtap="toggleTag"
          data-tag="{{item}}"
        >
          {{item}}
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button 
        class="btn btn-outline mr-sm"
        bindtap="showDetailRecord"
        wx:if="{{selectedEmotion}}"
      >
        è¯¦ç»†è®°å½•
      </button>
      <button 
        class="btn btn-primary flex-1"
        bindtap="quickSave"
        disabled="{{!selectedEmotion}}"
      >
        {{saveButtonText}}
      </button>
    </view>
  </view>

  <!-- ä»Šæ—¥ç»Ÿè®¡ -->
  <view class="today-stats card" wx:if="{{todayRecords.length > 0}}">
    <view class="card-title">ä»Šæ—¥æƒ…ç»ª</view>
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-number">{{todayRecords.length}}</view>
        <view class="stat-label">è®°å½•æ¬¡æ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{averageIntensity}}</view>
        <view class="stat-label">å¹³å‡å¼ºåº¦</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{dominantEmotion}}</view>
        <view class="stat-label">ä¸»è¦æƒ…ç»ª</view>
      </view>
    </view>
  </view>

  <!-- AI å¿«é€Ÿæ´å¯Ÿ -->
  <view class="ai-insight card" wx:if="{{aiInsight}}">
    <view class="card-title">
      <image class="ai-icon" src="../../assets/icons/ai.png" />
      AI æ´å¯Ÿ
    </view>
    <view class="insight-content">{{aiInsight}}</view>
    <view class="insight-actions">
      <text class="link-text" bindtap="viewDetailAnalysis">æŸ¥çœ‹è¯¦ç»†åˆ†æ</text>
    </view>
  </view>

  <!-- ç–—æ„ˆå»ºè®® -->
  <view class="healing-suggestion card" wx:if="{{healingSuggestion}}">
    <view class="card-title">ä»Šæ—¥å»ºè®®</view>
    <view class="suggestion-content">
      <image class="suggestion-icon" src="{{healingSuggestion.icon}}" />
      <view class="suggestion-text">
        <view class="suggestion-title">{{healingSuggestion.title}}</view>
        <view class="suggestion-desc">{{healingSuggestion.description}}</view>
      </view>
    </view>
    <button class="btn btn-outline btn-small" bindtap="tryHealing">
      ç«‹å³å°è¯•
    </button>
  </view>

  <!-- åº•éƒ¨å¯¼èˆªæç¤º -->
  <view class="bottom-tips" wx:if="{{showFirstTimeTip}}">
    <view class="tip-content">
      <text>ğŸ’¡ ç‚¹å‡»åº•éƒ¨"åˆ†æ"æŸ¥çœ‹æƒ…ç»ªè¶‹åŠ¿ï¼Œ"ç¤¾åŒº"ä¸ä»–äººåˆ†äº«å¿ƒæƒ…</text>
    </view>
  </view>
</view>

<!-- è¯¦ç»†è®°å½•å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showDetailModal}}" bindtap="hideDetailModal">
  <view class="modal-content" catchtap="">
    <view class="modal-header">
      <view class="modal-title">è¯¦ç»†è®°å½•</view>
      <view class="modal-close" bindtap="hideDetailModal">Ã—</view>
    </view>
    <view class="modal-body">
      <view class="input-group">
        <view class="input-label">è¯¦ç»†æè¿° (å¯é€‰)</view>
        <textarea 
          class="input textarea"
          placeholder="æè¿°ä¸€ä¸‹å½“æ—¶çš„æƒ…å†µå’Œæ„Ÿå—..."
          value="{{detailDescription}}"
          bindinput="onDescriptionInput"
          maxlength="200"
        />
        <view class="char-count">{{detailDescription.length}}/200</view>
      </view>
      
      <view class="input-group">
        <view class="input-label">åœ°ç‚¹ (å¯é€‰)</view>
        <input 
          class="input"
          placeholder="åœ¨å“ªé‡Œå‘ç”Ÿçš„ï¼Ÿ"
          value="{{location}}"
          bindinput="onLocationInput"
        />
      </view>

      <view class="input-group">
        <view class="checkbox-item" bindtap="toggleVoiceRecord">
          <view class="checkbox {{enableVoiceRecord ? 'checked' : ''}}"></view>
          <text>è¯­éŸ³è®°å½• (æœ¬åœ°å¤„ç†)</text>
        </view>
      </view>
    </view>
    <view class="modal-actions">
      <button class="btn btn-outline mr-sm" bindtap="hideDetailModal">å–æ¶ˆ</button>
      <button class="btn btn-primary" bindtap="saveDetailRecord">ä¿å­˜è®°å½•</button>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{isLoading}}">
  <view class="loading-content">
    <view class="loading"></view>
    <text>{{loadingText}}</text>
  </view>
</view>